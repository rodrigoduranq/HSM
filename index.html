<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Genesys Client App - SAE1</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 18px; background:#f7f8fa; }
    .card { background:#fff; border-radius:10px; padding:16px; box-shadow:0 6px 18px rgba(20,20,30,0.06); max-width:700px; margin:0 auto; }
    h2 { margin:0 0 10px 0; }
    label { display:block; margin-top:12px; font-size:13px; color:#444; }
    input[type="text"] { width:100%; padding:8px; border-radius:6px; border:1px solid #d6dbe3; margin-top:6px; }
    button { margin-top:16px; padding:10px 14px; border-radius:8px; border:0; background:#0b6cff; color:white; font-weight:600; cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .status { margin-top:12px; white-space:pre-wrap; font-size:13px; }
    .ok { color:#065f46; }
    .err { color:#b91c1c; }
    .muted { color:#6b7280; font-size:13px; margin-bottom:10px; }
    code { font-family: monospace; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Client App Genesys - SAE1</h2>
    <div class="muted">
      Regi√≥n: <code>apps.sae1.pure.cloud</code><br/>
      Data Action: <code>custom_-_4ae2533e-dbec-4148-8ccb-c204ee03a94f</code>
    </div>

    <div id="userBox">Usuario: cargando...</div>

    <form id="form">
      <label>id</label>
      <input id="id" type="text" value="1817712608858479"/>

      <label>name</label>
      <input id="name" type="text" value="test_genesys"/>

      <label>from</label>
      <input id="from" type="text" value="5491168690967"/>

      <label>to</label>
      <input id="to" type="text" value="5493517022819"/>

      <label>nombre</label>
      <input id="nombre" type="text" value="lean"/>

      <label>dato</label>
      <input id="dato" type="text" value="holas"/>

      <button id="btnEnviar" type="button">Enviar</button>
    </form>

    <div id="status" class="status"></div>
  </div>

  <script src="https://sdk-cdn.mypurecloud.com/javascript/latest/purecloud-platform-client-v2.min.js"></script>

  <script>
    (function () {

      // ==============================
      // üîê SOLO PON TU CLIENT ID AQU√ç
      // ==============================
      const OAUTH_CLIENT_ID = "2502f686-e6af-486a-b9a0-8b48eb07bc41";

      const API_BASE = "https://api.sae1.pure.cloud";
      const ACTION_ID = "custom_-_4ae2533e-dbec-4148-8ccb-c204ee03a94f";

      const platformClient = require('platformClient');
      const client = platformClient.ApiClient.instance;
      const usersApi = new platformClient.UsersApi();
      const integrationsApi = new platformClient.IntegrationsApi();

      const userBox = document.getElementById('userBox');
      const statusEl = document.getElementById('status');
      const btnEnviar = document.getElementById('btnEnviar');

      function setStatusOk(msg){
        statusEl.className = "status ok";
        statusEl.textContent = msg;
      }

      function setStatusErr(msg){
        statusEl.className = "status err";
        statusEl.textContent = msg;
      }

      function forceRegion(){
        client.basePath = API_BASE;
      }

      function buildParameters(){
        return {
          id: document.getElementById('id').value,
          name: document.getElementById('name').value,
          from: document.getElementById('from').value,
          to: document.getElementById('to').value,
          nombre: document.getElementById('nombre').value,
          dato: document.getElementById('dato').value
        };
      }

      async function ensureAuth(){
        if (!OAUTH_CLIENT_ID || OAUTH_CLIENT_ID === "PEGA_AQUI_TU_CLIENT_ID"){
          throw new Error("Debes configurar el OAUTH_CLIENT_ID");
        }

        forceRegion();

        const redirectUri = window.location.origin + window.location.pathname;

        const token = client.authData && client.authData.accessToken;
        if (token) return;

        await client.loginImplicitGrant(OAUTH_CLIENT_ID, redirectUri);
      }

      async function loadUser(){
        await ensureAuth();
        const me = await usersApi.getUsersMe();
        userBox.innerHTML = "Usuario: <strong>" + me.name + "</strong> | ID: " + me.id;
      }

      async function executeDataAction(){
        await ensureAuth();

        // üëá IMPORTANTE: enviar objeto plano (no { parameters: {...} })
        const body = buildParameters();

        return await integrationsApi.postIntegrationsActionExecute(ACTION_ID, body);
      }

      btnEnviar.addEventListener("click", async function(){
        btnEnviar.disabled = true;
        setStatusOk("Ejecutando Data Action...");

        try{
          const result = await executeDataAction();
          setStatusOk("‚úÖ Data Action ejecutado correctamente:\n" + JSON.stringify(result, null, 2));
        }catch(err){
          const details = err.body ? JSON.stringify(err.body, null, 2) : err.message;
          setStatusErr("‚ùå Error:\n" + details);
          console.error(err);
        }finally{
          btnEnviar.disabled = false;
        }
      });

      (async function init(){
        try{
          await loadUser();
          setStatusOk("Listo.");
        }catch(e){
          setStatusErr("Error autenticando:\n" + e.message);
        }
      })();

    })();
  </script>
</body>
</html>

